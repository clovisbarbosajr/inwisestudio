<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INWISE STUDIO — NanoBanana</title>
  <link href="https://techideia.net/genapp/style.css" rel="stylesheet"/>
  <style>
    :root {
      --brand:#00CFFF; --brand-weak:rgba(0,207,255,.35);
      --bg:#0a1a33; --surface:#0f2b4f; --text:#fff; --muted:rgba(255,255,255,.78);
      --border:rgba(255,255,255,.08); --r-lg:16px; --r-md:12px;
    }
    html,body{height:100%;background:
      radial-gradient(1200px 600px at 70% -20%, rgba(0,207,255,.12), transparent 60%),
      radial-gradient(800px 500px at 20% 120%, rgba(0,207,255,.08), transparent 60%),
      linear-gradient(180deg, #0a1a33 0%, #081427 100%);
      color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;overflow-x:hidden}
    #sparkles{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.6;filter:drop-shadow(0 0 6px rgba(0,207,255,.6)) blur(0.8px)}
    .wrap{position:relative;z-index:1;max-width:1100px;margin:36px auto;padding:0 16px}
    header{text-align:center;margin-bottom:22px}
    .title{font-weight:900;font-size:clamp(26px,4vw,40px);
      background:linear-gradient(135deg,var(--brand),#68e3ff);-webkit-background-clip:text;background-clip:text;color:transparent}
    .subtitle{color:var(--muted)}
    .grid{display:grid;gap:18px}
    @media(min-width:1000px){.grid{grid-template-columns:420px 1fr}}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
      border:1px solid var(--border);border-radius:var(--r-lg);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
      box-shadow:0 20px 60px rgba(0,0,0,.35), 0 0 0 1px rgba(0,207,255,.06) inset}
    .left{padding:18px}.right{padding:18px}
    .panel-title{font-size:20px;font-weight:800;color:#c9f6ff;margin-bottom:6px}
    .panel-sub{color:var(--muted);margin-bottom:12px}
    .select, .input, textarea{width:100%;color:var(--text);background:rgba(255,255,255,.04);
      border:1px solid var(--border);border-radius:var(--r-md);padding:10px 12px}
    textarea{min-height:110px;resize:vertical}
    .section-title{margin:12px 0 6px;font-weight:800;color:#c9f6ff}
    .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .upload{border:1px dashed var(--brand-weak);border-radius:12px;color:var(--muted);padding:16px;text-align:center;background:rgba(0,207,255,.03);cursor:pointer}
    .upload:hover{background:rgba(0,207,255,.06)}
    .preview{display:block;max-width:100%;border-radius:10px;margin-top:10px;border:1px solid var(--border)}
    .placeholder{border:1px dashed var(--brand-weak);border-radius:14px;padding:38px;text-align:center;color:var(--muted);background:rgba(0,207,255,.03)}
    .loading{display:none;gap:8px;align-items:center;color:var(--muted)}
    .imgbox{display:none}.imgbox img{max-width:100%;border-radius:12px;border:1px solid var(--border)}
    .actions{display:flex;gap:10px;margin-top:10px}
    .action{flex:1;background:rgba(255,255,255,.05);border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    .action:hover{transform:translateY(-1px);box-shadow:0 14px 36px rgba(0,207,255,.18)}
    .btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;width:100%;padding:12px 14px;margin-top:12px;
      border:1px solid var(--brand-weak);
      background:radial-gradient(120% 120% at 50% 0%, rgba(0,207,255,.22), rgba(0,207,255,.07) 55%, rgba(0,207,255,.04) 100%);
      color:var(--text);font-weight:800;letter-spacing:.3px;cursor:pointer;
      box-shadow:0 8px 26px rgba(0,207,255,.12), 0 0 0 1px rgba(0,207,255,.10) inset}
    .btn:hover{transform:translateY(-1px);box-shadow:0 14px 36px rgba(0,207,255,.18)}
    .spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.25);border-top-color:var(--brand);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .hint{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
  </style>
</head>
<body>
<canvas id="sparkles"></canvas>
<div class="wrap">
<header>
<h1 class="title">INWISE STUDIO</h1>
<p class="subtitle">Gerador de Imagens Profissional com NanoBanana</p>
</header>
<div class="grid">
<div class="panel left">
<div class="panel-title">Painel de Controle</div>
<div class="panel-sub">Crie ou edite imagens com o NanoBanana</div>
<div class="section-title">Descreva sua ideia:</div>
<textarea id="prompt" class="input" placeholder=""></textarea>

<div class="section-title">Upload Local</div>
<div class="upload" onclick="document.getElementById('imageUpload').click()">
Selecione uma imagem (opcional)
<input id="imageUpload" type="file" accept="image/*" hidden onchange="handleImageUpload(this,'imagePreview')"/>
<img id="imagePreview" class="preview"/>
</div>

<div class="section-title">Image URL</div>
<input id="imageUrl" class="input" placeholder="https://example.com/image.jpg (opcional)"/>

<div class="section-title">Compose (mesclar duas imagens)</div>
<div class="grid2">
  <div class="upload" onclick="document.getElementById('imageUpload1').click()">
    Primeira imagem
    <input id="imageUpload1" type="file" accept="image/*" hidden onchange="handleImageUpload(this,'imagePreview1')"/>
    <img id="imagePreview1" class="preview"/>
  </div>
  <div class="upload" onclick="document.getElementById('imageUpload2').click()">
    Segunda imagem
    <input id="imageUpload2" type="file" accept="image/*" hidden onchange="handleImageUpload(this,'imagePreview2')"/>
    <img id="imagePreview2" class="preview"/>
  </div>
</div>

<button id="generateBtn" class="btn" onclick="generate()">
<span id="genSpin" class="spinner" style="display:none"></span>
<span>Gerar Imagem</span>
</button>
</div>

<div class="panel right">
<div id="placeholder" class="placeholder">Sua arte aparecerá aqui</div>
<div id="loading" class="loading"><div class="spinner"></div><div>Gerando...</div></div>
<div id="imgbox" class="imgbox">
<img id="out" alt="Generated"/>
<div class="actions">
<button class="action" onclick="downloadImage()">Download</button>
<button class="action" onclick="resetUI()">Novo</button>
</div>
</div>
</div>
</div>
<footer class="hint">© 2025 — INWISE</footer>
</div>

<script>
(function(){
  const c=document.getElementById('sparkles'),ctx=c.getContext('2d');
  let w,h,stars; const dpr=Math.min(2,devicePixelRatio||1);
  function size(){w=c.width=innerWidth*dpr;h=c.height=innerHeight*dpr;c.style.width=innerWidth+'px';c.style.height=innerHeight+'px';ctx.setTransform(1,0,0,1,0,0);ctx.scale(dpr,dpr);make();}
  function make(){const n=Math.round((innerWidth*innerHeight)/20000);
  stars=Array.from({length:n},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,r:Math.random()*1.3+.3,a:Math.random()*6,s:Math.random()*.4+.1}))}
  function draw(){ctx.clearRect(0,0,innerWidth,innerHeight);stars.forEach(s=>{s.a+=s.s*.02;const tw=(Math.sin(s.a)*.5+.5)*.7+.3;ctx.beginPath();ctx.arc(s.x,s.y,s.r*tw,0,Math.PI*2);ctx.fillStyle=`rgba(0,207,255,${.55*tw})`;ctx.fill();});requestAnimationFrame(draw);}
  addEventListener('resize',size);size();draw();
})();

const els={prompt:document.getElementById('prompt'),imgU:document.getElementById('imageUpload'),
imgPrev:document.getElementById('imagePreview'),imgU1:document.getElementById('imageUpload1'),
imgU2:document.getElementById('imageUpload2'),prev1:document.getElementById('imagePreview1'),
prev2:document.getElementById('imagePreview2'),imageUrl:document.getElementById('imageUrl'),
btn:document.getElementById('generateBtn'),spin:document.getElementById('genSpin'),
ph:document.getElementById('placeholder'),load:document.getElementById('loading'),
box:document.getElementById('imgbox'),out:document.getElementById('out')};

function handleImageUpload(input,targetId){
  const img=document.getElementById(targetId);
  const f=input.files&&input.files[0];if(!f){img.src='';return;}
  const r=new FileReader();r.onload=e=>img.src=e.target.result;r.readAsDataURL(f);
}

function ui(state){
  if(state==='loading'){els.ph.style.display='none';els.box.style.display='none';els.load.style.display='flex';els.spin.style.display='inline-block';}
  else if(state==='show'){els.load.style.display='none';els.spin.style.display='none';els.ph.style.display='none';els.box.style.display='block';}
  else{els.load.style.display='none';els.spin.style.display='none';els.box.style.display='none';els.ph.style.display='block';els.out.src='';}
}
function resetUI(){ui('idle');['imageUpload','imageUpload1','imageUpload2'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});['imagePreview','imagePreview1','imagePreview2'].forEach(id=>{const el=document.getElementById(id);if(el)el.src='';});document.getElementById('imageUrl').value='';}
function downloadImage(){if(!els.out.src)return;const a=document.createElement('a');a.href=els.out.src;a.download='inwise-image.png';a.click();}

async function composeTwo(pre1,pre2){
  return new Promise((resolve,reject)=>{
    const img1=new Image(),img2=new Image();
    img1.onload=()=>{img2.onload=()=>{
      const w=Math.max(img1.width,img2.width),h=Math.max(img1.height,img2.height);
      const c=document.createElement('canvas');c.width=w;c.height=h;const ctx=c.getContext('2d');
      ctx.drawImage(img1,0,0,w,h);ctx.globalAlpha=0.5;ctx.drawImage(img2,0,0,w,h);ctx.globalAlpha=1.0;
      resolve(c.toDataURL('image/png'));
    };img2.onerror=reject;img2.src=pre2;};img1.onerror=reject;img1.src=pre1;
  });
}

async function generate(){
  const prompt=(els.prompt.value||'').trim();
  if(!prompt){alert('Digite um prompt.');return;}
  const hasI2I=!!els.imgU.files[0];const hasCompose=!!els.imgU1.files[0]&&!!els.imgU2.files[0];
  const urlInput=(els.imageUrl.value||'').trim();ui('loading');

  try{
    let imgBlob=null;
    if(hasCompose){
      const blended=await composeTwo(els.prev1.src,els.prev2.src);
      const res=await fetch('https://nano-bnana.fak-official.workers.dev/image?prompt='+encodeURIComponent(prompt)+'&image='+encodeURIComponent(blended));
      if(!res.ok)throw new Error('Compose falhou (NanoBanana)');
      imgBlob=await res.blob();
    }else if(hasI2I){
      const b64=await fileToBase64(els.imgU.files[0]);
      const res=await fetch('https://nano-bnana.fak-official.workers.dev/image?prompt='+encodeURIComponent(prompt)+'&image='+encodeURIComponent(b64));
      if(!res.ok)throw new Error('i2i falhou');
      imgBlob=await res.blob();
    }else if(urlInput){
      const res=await fetch('https://nano-bnana.fak-official.workers.dev/image?prompt='+encodeURIComponent(prompt)+'&imageUrl='+encodeURIComponent(urlInput));
      if(!res.ok)throw new Error('URL falhou');
      imgBlob=await res.blob();
    }else{
      const res=await fetch('https://nano-bnana.fak-official.workers.dev/image?prompt='+encodeURIComponent(prompt));
      if(!res.ok)throw new Error('Geração falhou');
      imgBlob=await res.blob();
    }
    els.out.src=URL.createObjectURL(imgBlob);ui('show');
  }catch(e){
    console.error(e);
    // fallback OpenRouter
    try{
      const blended=(hasCompose)?await composeTwo(els.prev1.src,els.prev2.src):null;
      const body={model:'stability-ai/stable-diffusion-xl',prompt,images:blended?[blended]:undefined};
      const res=await fetch('https://openrouter.ai/api/v1/images',{
        method:'POST',headers:{'Authorization':'Bearer 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','Content-Type':'application/json'},body:JSON.stringify(body)});
      if(!res.ok)throw new Error('Fallback falhou');const blob=await res.blob();
      els.out.src=URL.createObjectURL(blob);ui('show');
    }catch(err){ui('idle');alert('Erro: '+err.message);}
  }
}
function fileToBase64(file){return new Promise((res,rej)=>{const r=new FileReader();r.onload=e=>res(e.target.result);r.onerror=rej;r.readAsDataURL(file);});}
</script>
</body>
</html>